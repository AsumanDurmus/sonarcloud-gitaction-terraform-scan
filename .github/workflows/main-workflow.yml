name: "Main Workflow"
on:
  workflow_dispatch:

jobs:
  Sonar_Scan:
    if: github.ref == 'refs/heads/main'
    uses: e2eSolutionArchitect/sonarcloud-gitaction-terraform-scan/.github/workflows/sonar-cloud-scan.yml@main
    
  Plan_Dev:
    if: github.ref == 'refs/heads/main'
    uses: e2eSolutionArchitect/sonarcloud-gitaction-terraform-scan/.github/workflows/aws_tf_plan.yml@main
    with:
      #path: templates/small
      tf_version: 1.7.1
      tf_vars_file: env/dev.tfvars
      gh_environment: dev

  Deploy_Dev:
    needs: Plan_Dev
    uses: e2eSolutionArchitect/sonarcloud-gitaction-terraform-scan/.github/workflows/aws_tf_apply.yml@main
    with:
      #path: templates/small
      tf_version: 1.7.1
      tf_vars_file: env/dev.tfvars
      gh_environment: dev
